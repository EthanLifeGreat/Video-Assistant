<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>bilibili视频助手</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin: 20px 0;
        }

        form {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        input[type="text"] {
            width: 70%;
            padding: 8px;
            margin-right: 10px;
        }

        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-left: 4px solid #4CAF50;
        }

        .error {
            color: red;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<h1>bilibili视频助手</h1>

<form id="videoForm" method="POST" style="display: flex; align-items: center; gap: 10px;">
    <label for="input_field">请输入视频链接：</label>
    <input type="text"
           id="input_field"
           name="user_input"
           required
           style="flex: 1;">
    <button type="submit">视频预览</button>
</form>

<div id="videoContainer" class="video-container"></div>
<div id="errorMsg" class="error"></div>

<script>
    document.getElementById('videoForm').addEventListener('submit', async (e) => {
        e.preventDefault();  // 防止页面刷新
        const url = document.getElementById('input_field').value;  // 直接获取用户输入
        const container = document.getElementById('videoContainer');
        const errorBox = document.getElementById('errorMsg');

        try {
            const res = await fetch('/api/get_video', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({url})  // ✅ 只传 URL
            });
            const data = await res.json();

            if (res.ok) {
                errorBox.innerText = '';
                container.innerHTML = `
                    <h3>${data.title}</h3>
                    <video controls width="100%" src="${data.video_url}"></video>
                `;
            } else {
                errorBox.innerText = data.error || '请求失败';
                container.innerHTML = '';
            }
        } catch (err) {
            errorBox.innerText = '请求出错，请检查网络或控制台';
            console.error('Error:', err);
        }
    });
</script>
</body>
</html>
